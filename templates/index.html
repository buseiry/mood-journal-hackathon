<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mood Lab — Fast UI</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="manifest" href="/static/manifest.json">
  <meta name="theme-color" content="#7c3aed">

  <style>
    :root{--bg:#071028;--card:#fff;--accent1:#7c3aed;--accent2:#06b6d4;--muted:#64748b;--radius:14px}
    *{box-sizing:border-box} html,body{height:100%;margin:0;font-family:Inter,system-ui; background:linear-gradient(135deg,#071028,#081124); color:#071028}
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:22px}
    .app{width:100%;max-width:1100px;display:grid;grid-template-columns:1fr 420px;gap:22px}
    @media(max-width:980px){.app{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.98),rgba(255,255,255,0.94));padding:22px;border-radius:var(--radius);box-shadow:0 12px 40px rgba(2,6,23,0.55)}
    header.app-head{display:flex;gap:16px;align-items:center;margin-bottom:14px}
    .logo{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent1),var(--accent2));color:white;font-size:22px}
    h1{font-size:20px;margin:0;font-weight:700} p.lead{margin:0;color:var(--muted);font-size:13px}
    textarea#entry{width:100%;min-height:160px;padding:14px;margin-top:12px;border-radius:12px;border:1px solid rgba(11,18,32,0.06);font-size:15px}
    textarea:focus{outline:none;box-shadow:0 6px 30px rgba(17,24,39,0.06);border-color:rgba(124,58,237,0.3)}
    .actions{display:flex;gap:12px;align-items:center;margin-top:14px}
    button.primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;border:0;padding:10px 16px;border-radius:999px;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(11,18,32,0.06);padding:10px 14px;border-radius:999px;color:var(--muted);cursor:pointer}
    .status-row{display:flex;gap:12px;align-items:center;margin-top:16px}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:8px 10px;border-radius:999px;background:rgba(255,255,255,0.06);font-size:13px;color:var(--muted)}
    .result{margin-top:18px;display:flex;gap:18px;align-items:center;flex-wrap:wrap}
    .big-emotion{min-width:120px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(180deg,#fff,#f7fbff);padding:14px;border-radius:12px}
    .big-emoji{font-size:42px} .big-label{font-weight:700;font-size:16px}
    .score-bar{width:140px;height:10px;border-radius:8px;background:#eef2ff;overflow:hidden}
    .score-fill{height:100%;border-radius:8px;background:linear-gradient(90deg,var(--accent1),var(--accent2));width:0}
    .chips{display:flex;gap:10px;flex-wrap:wrap}
    .chip{padding:8px 12px;border-radius:999px;font-size:13px;background:#fff;border:1px solid rgba(11,18,32,0.04)}
    .right{display:flex;flex-direction:column;gap:18px}
    .panel{background:linear-gradient(180deg,#fff,#fbfdff);border-radius:12px;padding:16px;box-shadow:0 10px 30px rgba(2,6,23,0.06)}
    .history-list{display:flex;flex-direction:column;gap:10px;max-height:300px;overflow:auto}
    .entry{display:flex;justify-content:space-between;gap:12px;align-items:center;padding:10px;border-radius:10px;background:#fff;border:1px solid rgba(11,18,32,0.03)}
    .entry .text{font-size:13px;color:#071028;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .entry .time{font-size:12px;color:var(--muted)}
    .badge{padding:6px 10px;border-radius:999px;font-weight:700;font-size:12px}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:28px;background:rgba(10,14,20,0.92);color:white;padding:12px 18px;border-radius:12px;font-weight:600;display:none;z-index:40}
    .auth-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(7,16,40,0.92);display:flex;align-items:center;justify-content:center;z-index:100;padding:20px}
    .auth-container{background:white;border-radius:16px;padding:28px;width:100%;max-width:400px;box-shadow:0 20px 60px rgba(0,0,0,0.3)}
    .auth-tabs{display:flex;margin-bottom:22px;border-bottom:1px solid rgba(0,0,0,0.08)}
    .auth-tab{flex:1;text-align:center;padding:12px;cursor:pointer;font-weight:600;color:var(--muted);border-bottom:3px solid transparent}
    .auth-tab.active{color:var(--accent1);border-bottom-color:var(--accent1)}
    .auth-form{display:none}
    .auth-form.active{display:block}
    .auth-input{margin-bottom:16px}
    .auth-input input{width:100%;padding:12px 16px;border-radius:10px;border:1px solid rgba(0,0,0,0.1);font-size:15px}
    .auth-input input:focus{outline:none;border-color:var(--accent1)}
    .auth-submit{width:100%;padding:12px;border-radius:10px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;border:0;font-weight:600;cursor:pointer;margin-top:8px}
    .auth-error{margin-top:12px;padding:10px;background:#fee;border-radius:8px;color:#c33;font-size:14px;display:none}
    .user-menu{display:flex;align-items:center;gap:10px;margin-left:auto}
    .user-avatar{width:36px;height:36px;border-radius:50%;background:var(--accent1);display:flex;align-items:center;justify-content:center;color:white;font-weight:600}
    .user-email{font-size:13px;color:var(--muted)}
    .logout-btn{background:none;border:none;color:var(--muted);cursor:pointer;font-size:13px}
  </style>
</head>
<body>
  <!-- Auth Modal -->
  <div class="auth-modal" id="authModal" style="display: flex;">
    <div class="auth-container">
      <div class="auth-tabs">
        <div class="auth-tab active" data-tab="login">Login</div>
        <div class="auth-tab" data-tab="signup">Sign Up</div>
      </div>
      
      <form class="auth-form active" id="loginForm">
        <div class="auth-input">
          <input type="email" id="loginEmail" placeholder="Email" required>
        </div>
        <div class="auth-input">
          <input type="password" id="loginPassword" placeholder="Password" required>
        </div>
        <button type="submit" class="auth-submit">Login</button>
        <div class="auth-error" id="loginError"></div>
      </form>
      
      <form class="auth-form" id="signupForm">
        <div class="auth-input">
          <input type="email" id="signupEmail" placeholder="Email" required>
        </div>
        <div class="auth-input">
          <input type="password" id="signupPassword" placeholder="Password" required>
        </div>
        <button type="submit" class="auth-submit">Create Account</button>
        <div class="auth-error" id="signupError"></div>
      </form>
    </div>
  </div>

  <div class="wrap">
    <div class="app">
      <div class="card">
        <header class="app-head">
          <div class="logo"><i class="fa-solid fa-face-smile"></i></div>
          <div>
            <h1>Mood Lab</h1>
            <p class="lead">Fast, clear emotion analysis. Works with your backend.</p>
          </div>
          <div class="user-menu" id="userMenu" style="display:none">
            <div class="user-avatar" id="userAvatar"></div>
            <div class="user-email" id="userEmail"></div>
            <button class="logout-btn" id="logoutBtn">Logout</button>
          </div>
        </header>

        <div id="authRequired" style="text-align:center;padding:40px 0;">
          <p>Please log in to use Mood Lab</p>
          <button class="primary" id="showAuthBtn">Login / Sign Up</button>
        </div>

        <div id="appContent" style="display:none">
          <label for="entry" class="muted">Write a short journal entry or a line of text</label>
          <textarea id="entry" placeholder="Type how you feel... Example: 'I got a promotion and I feel excited'"></textarea>

          <div class="actions">
            <button class="primary" id="btnAnalyze"><i class="fa-solid fa-bolt"></i>&nbsp;Analyze</button>
            <button class="ghost" id="btnClear"><i class="fa-solid fa-eraser"></i>&nbsp;Clear</button>
            <div style="flex:1"></div>
            <div class="pill" id="countPill">Entries: —</div>
          </div>

          <div class="status-row" id="statusRow" style="display:none">
            <div class="pill" id="lastAnalyzed">Last: —</div>
            <div class="pill" id="confidencePill">Confidence: —</div>
          </div>

          <div class="result" id="resultArea" style="display:none">
            <div class="big-emotion" aria-live="polite">
              <div class="big-emoji" id="resEmoji">🙂</div>
              <div class="big-label" id="resLabel">Neutral</div>
              <div class="score-bar"><div class="score-fill" id="resFill"></div></div>
            </div>

            <div style="flex:1">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div class="muted">Detected emotions</div>
                <div class="muted" id="rawLabelCount">—</div>
              </div>
              <div class="chips" id="chips"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="right" id="appRightPanel" style="display:none">
        <div class="panel">
          <h3>Recent history</h3>
          <div class="history-list" id="historyList" aria-live="polite"></div>
        </div>

        <div class="panel">
          <h3>Mood trend</h3>
          <div style="margin-top:8px"><canvas id="trendChart" width="400" height="160"></canvas></div>
          <div style="height:12px"></div>
          <h3 style="margin-top:6px">Frequency</h3>
          <div style="margin-top:8px"><canvas id="freqChart" width="400" height="120"></canvas></div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // JavaScript for auth, analyze, charts, history, toast notifications
    const API={analyze:'/analyze',history:'/history',login:'/login',signup:'/signup',logout:'/logout',user:'/user'};
    const CANON={joy:'joy',happy:'joy',excited:'joy',surprise:'surprise',neutral:'neutral',sad:'sadness',sadness:'sadness',angry:'anger',anger:'anger',disgust:'disgust',fear:'fear'};
    const EMOTIONS=['anger','disgust','fear','sadness','neutral','surprise','joy'];
    const EMO_META={anger:{name:'Anger',emoji:'😡',color:'#ff6b6b'},disgust:{name:'Disgust',emoji:'🤢',color:'#8bc34a'},fear:{name:'Fear',emoji:'😨',color:'#ff9f1c'},sadness:{name:'Sad',emoji:'😢',color:'#3b82f6'},neutral:{name:'Neutral',emoji:'😐',color:'#94a3b8'},surprise:{name:'Surprise',emoji:'😲',color:'#a78bfa'},joy:{name:'Joy',emoji:'😄',color:'#f6c94c'}};
    const VALUE_OF=EMOTIONS.reduce((a,k,i)=>(a[k]=i,a),{});

    const authModal=document.getElementById('authModal'),loginForm=document.getElementById('loginForm'),signupForm=document.getElementById('signupForm'),loginError=document.getElementById('loginError'),signupError=document.getElementById('signupError'),authTabs=document.querySelectorAll('.auth-tab'),authForms=document.querySelectorAll('.auth-form'),showAuthBtn=document.getElementById('showAuthBtn'),authRequired=document.getElementById('authRequired'),appContent=document.getElementById('appContent'),appRightPanel=document.getElementById('appRightPanel'),userMenu=document.getElementById('userMenu'),userAvatar=document.getElementById('userAvatar'),userEmail=document.getElementById('userEmail'),logoutBtn=document.getElementById('logoutBtn'),entryEl=document.getElementById('entry'),btnAnalyze=document.getElementById('btnAnalyze'),btnClear=document.getElementById('btnClear'),toastEl=document.getElementById('toast'),resultArea=document.getElementById('resultArea'),resEmoji=document.getElementById('resEmoji'),resLabel=document.getElementById('resLabel'),resFill=document.getElementById('resFill'),chips=document.getElementById('chips'),historyList=document.getElementById('historyList'),countPill=document.getElementById('countPill'),lastAnalyzed=document.getElementById('lastAnalyzed'),confidencePill=document.getElementById('confidencePill'),rawLabelCount=document.getElementById('rawLabelCount');

    let trendChart=null,freqChart=null,currentUser=null;

    function showAuthModal(){authModal.style.display='flex';}
    function hideAuthModal(){authModal.style.display='none';loginError.style.display='none';signupError.style.display='none';loginForm.reset();signupForm.reset();}
    function switchAuthTab(tabName){authTabs.forEach(t=>t.classList.remove('active'));authForms.forEach(f=>f.classList.remove('active'));document.querySelector(`.auth-tab[data-tab="${tabName}"]`).classList.add('active');document.getElementById(`${tabName}Form`).classList.add('active');}
    async function loginUser(email,password){try{const r=await fetch(API.login,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password}),credentials:'include'});const d=await r.json();if(r.ok){currentUser=d.user;updateUIForUser();hideAuthModal();showToast('Login successful');loadHistory();return true;}else{loginError.textContent=d.error||'Login failed';loginError.style.display='block';return false;}}catch(e){loginError.textContent='Network error. Please try again.';loginError.style.display='block';return false;}}
    async function signupUser(email,password){try{const r=await fetch(API.signup,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password}),credentials:'include'});const d=await r.json();if(r.ok){currentUser=d.user;updateUIForUser();hideAuthModal();showToast('Account created successfully');loadHistory();return true;}else{signupError.textContent=d.error||'Signup failed';signupError.style.display='block';return false;}}catch(e){signupError.textContent='Network error. Please try again.';signupError.style.display='block';return false;}}
    async function logoutUser(){try{await fetch(API.logout,{method:'POST',credentials:'include'});}catch(e){console.error(e);}finally{currentUser=null;updateUIForUser();showToast('Logged out successfully');}}
    async function checkAuthStatus(){try{const r=await fetch(API.user,{credentials:'include'});if(r.ok){const d=await r.json();currentUser=d.user;updateUIForUser();loadHistory();return true;}}catch(e){console.error(e);}currentUser=null;updateUIForUser();return false;}
    function updateUIForUser(){if(currentUser){authRequired.style.display='none';appContent.style.display='block';appRightPanel.style.display='flex';userMenu.style.display='flex';userAvatar.textContent=currentUser.email.charAt(0).toUpperCase();userEmail.textContent=currentUser.email;authModal.style.display='none';}else{authRequired.style.display='block';appContent.style.display='none';appRightPanel.style.display='none';userMenu.style.display='none';historyList.innerHTML='';countPill.textContent='Entries: —';authModal.style.display='flex';}}
    authTabs.forEach(t=>t.addEventListener('click',()=>switchAuthTab(t.dataset.tab)));
    loginForm.addEventListener('submit',async e=>{e.preventDefault();await loginUser(document.getElementById('loginEmail').value,document.getElementById('loginPassword').value);});
    signupForm.addEventListener('submit',async e=>{e.preventDefault();await signupUser(document.getElementById('signupEmail').value,document.getElementById('signupPassword').value);});
    showAuthBtn.addEventListener('click',showAuthModal);
    logoutBtn.addEventListener('click',logoutUser);

    function showToast(msg){toastEl.textContent=msg;toastEl.style.display='block';setTimeout(()=>{toastEl.style.display='none'},3000);}
    function updateResultUI(emotion,score,details){resEmoji.textContent=EMO_META[emotion].emoji;resLabel.textContent=EMO_META[emotion].name;resFill.style.width=`${Math.floor(score*100)}%`;chips.innerHTML='';Object.entries(details).forEach(([k,v])=>{const chip=document.createElement('div');chip.className='chip';chip.textContent=`${EMO_META[k].emoji} ${EMO_META[k].name}: ${Math.floor(v*100)}%`;chips.appendChild(chip);});resultArea.style.display='flex';}
    async function analyzeEntry(){const text=entryEl.value.trim();if(!text){showToast('Please write something first');return;}try{const r=await fetch(API.analyze,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text}),credentials:'include'});const d=await r.json();if(r.ok){const main=d.main;updateResultUI(main.emotion,main.score,main.details);lastAnalyzed.textContent=new Date().toLocaleTimeString();confidencePill.textContent=Math.floor(main.score*100)+'%';loadHistory();}else{showToast('Analysis failed');}}catch(e){showToast('Network error');}}
    btnAnalyze.addEventListener('click',analyzeEntry);
    btnClear.addEventListener('click',()=>{entryEl.value='';resultArea.style.display='none';});

    async function loadHistory(){try{const r=await fetch(API.history,{credentials:'include'});const d=await r.json();if(r.ok){historyList.innerHTML='';countPill.textContent='Entries: '+d.entries.length;const trendLabels=[],trendData=[],freqData={};EMOTIONS.forEach(e=>freqData[e]=0);d.entries.forEach(e=>{trendLabels.push(new Date(e.date).toLocaleDateString());trendData.push(VALUE_OF[e.emotion]||0);freqData[e.emotion]=(freqData[e.emotion]||0)+1;const div=document.createElement('div');div.className='entry';div.innerHTML=`<div class="text">${e.text}</div><div class="time">${new Date(e.date).toLocaleTimeString()}</div>`;historyList.appendChild(div);});renderTrendChart(trendLabels,trendData);renderFreqChart(freqData);}}catch(e){console.error(e);}}
    
    function renderTrendChart(labels,data){if(trendChart)trendChart.destroy();const ctx=document.getElementById('trendChart').getContext('2d');trendChart=new Chart(ctx,{type:'line',data:{labels, datasets:[{label:'Mood',data:data,borderColor:'#7c3aed',backgroundColor:'rgba(124,58,237,0.2)',tension:0.4}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{ticks:{stepSize:1,callback:v=>EMOTIONS[v]||''}}}}});}
    function renderFreqChart(freq){if(freqChart)freqChart.destroy();const ctx=document.getElementById('freqChart').getContext('2d');freqChart=new Chart(ctx,{type:'bar',data:{labels:EMOTIONS.map(e=>EMO_META[e].name),datasets:[{label:'Frequency',data:EMOTIONS.map(e=>freq[e]),backgroundColor:EMOTIONS.map(e=>EMO_META[e].color)}]},options:{responsive:true,plugins:{legend:{display:false}}}});}
    
    checkAuthStatus();
  </script>
</body>
</html>
